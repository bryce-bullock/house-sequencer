<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ultimate DJ Studio</title>
<style>
body{margin:0;background:#111;color:#eee;font-family:sans-serif;display:flex;flex-direction:column;align-items:center;}
#app{width:95%;max-width:1400px;margin:10px;}
h1{text-align:center;margin-bottom:10px;}
.panel{background:linear-gradient(145deg,#1a1a1a,#222);border-radius:12px;padding:20px;margin:10px;display:flex;flex-wrap:wrap;justify-content:center;}
.knob-container{display:flex;flex-direction:column;align-items:center;margin:10px;}
.knob, .slider{width:60px;height:60px;border-radius:50%;background:linear-gradient(145deg,#333,#111);border:4px solid #555;display:flex;align-items:center;justify-content:center;cursor:pointer;position:relative;box-shadow:2px 2px 5px #000 inset,-2px -2px 5px #555 inset;}
.knob:after{content:'';position:absolute;width:4px;height:20px;background:#ff5722;top:10px;left:50%;transform:translateX(-50%) rotate(0deg);transform-origin:bottom center;transition: transform 0.1s;border-radius:2px;}
.label{margin-top:8px;font-size:14px;text-align:center;}
.pad{width:60px;height:60px;background:linear-gradient(145deg,#222,#333);margin:5px;border-radius:8px;display:flex;align-items:center;justify-content:center;cursor:pointer;user-select:none;box-shadow:2px 2px 5px #000 inset,-2px -2px 5px #555 inset;font-weight:bold;}
.pad.active{background:#ff5722;box-shadow:none;}
#sequencer{display:flex;flex-wrap:wrap;justify-content:center;margin-top:10px;}
.step{width:30px;height:30px;margin:2px;border-radius:4px;background:#333;cursor:pointer;display:flex;align-items:center;justify-content:center;box-shadow:2px 2px 4px #000 inset,-2px -2px 4px #555 inset;}
.step.active{background:#ff5722;}
#visualizer{width:100%;height:160px;background:#111;margin-top:20px;border:1px solid #333;border-radius:8px;}
button{background:#333;border:none;color:#eee;padding:8px 12px;border-radius:6px;margin:4px;cursor:pointer;font-weight:bold;box-shadow:2px 2px 5px #000 inset,-2px -2px 5px #555 inset;}
button:hover{background:#555;}
#startAudioBtn{background:#43a047;}
@media(max-width:768px){
  .knob, .slider{width:50px;height:50px;}
  .pad{width:50px;height:50px;}
  .step{width:25px;height:25px;}
}
</style>
</head>
<body>
<div id="app">
<h1>Ultimate DJ Studio</h1>
<div class="panel" id="controlsPanel">
  <button id="startAudioBtn">Start Audio</button>
</div>
<div class="panel" id="padPanel"></div>
<div class="panel" id="sequencer"></div>
<canvas id="visualizer"></canvas>
<script>
// Audio Context and Master Controls
let ctx, masterGain, masterPlaybackRate=1, audioStarted=false;
const startBtn=document.getElementById('startAudioBtn');

startBtn.onclick=async ()=>{
  if(!audioStarted){
    ctx=new (window.AudioContext||window.webkitAudioContext)();
    masterGain=ctx.createGain(); masterGain.gain.value=0.8; masterGain.connect(ctx.destination);
    audioStarted=true; startBtn.textContent='Audio Playing';
    // Initialize FX rack and pads after audio context is running
    initPads();
    initSequencer();
    initFX();
    initVisualizer();
  } else {
    await ctx.suspend(); audioStarted=false; startBtn.textContent='Audio Stopped';
  }
};

// Utility for Knob / Slider (auto-switch to slider for touch)
function createControl(el, callback){
  if('ontouchstart' in window){
    // Touch devices use vertical slider
    let startY, startVal=0;
    el.addEventListener('touchstart',e=>{ startY=e.touches[0].clientY; });
    el.addEventListener('touchmove',e=>{
      e.preventDefault();
      const delta=startY - e.touches[0].clientY;
      let value=Math.min(1,Math.max(0,startVal + delta/100));
      callback(value);
    });
    el.addEventListener('touchend',()=>{ startVal=callback.value||0; });
  } else {
    // Desktop knob rotation
    let isDragging=false, angle=0;
    el.addEventListener('mousedown',()=>{isDragging=true;});
    window.addEventListener('mouseup',()=>{isDragging=false;});
    window.addEventListener('mousemove',(e)=>{
      if(!isDragging) return;
      const rect=el.getBoundingClientRect();
      const y=e.clientY-rect.top-rect.height/2;
      const x=e.clientX-rect.left-rect.width/2;
      angle=Math.min(135,Math.max(-135,Math.atan2(y,x)*180/Math.PI));
      el.querySelector(':after').style.transform=`translateX(-50%) rotate(${angle}deg)`;
      callback((angle+135)/270);
    });
  }
}

// Pads setup
const padPanel=document.getElementById('padPanel');
const padNames=['Kick','Snare','HiHat','Clap','Piano','Trumpet','Synth'];
const sampleBuffers={};
async function loadSamples(){
  for(const name of padNames){
    // Minimal placeholder samples; replace with full Base64 later
    const response=await fetch('data:audio/wav;base64,UklGRiQAAABXQVZFZm10IBAAAAABAAEAQB8AAIA+AAACABAAZGF0YQAAAAA=');
    const arrayBuffer=await response.arrayBuffer();
    sampleBuffers[name]=await ctx.decodeAudioData(arrayBuffer);
  }
}

function playSample(name){
  if(!sampleBuffers[name]) return;
  const src=ctx.createBufferSource(); src.buffer=sampleBuffers[name];
  src.playbackRate.value=masterPlaybackRate;
  src.connect(masterGain); src.start();
}

function initPads(){
  loadSamples().then(()=>{
    padNames.forEach(name=>{
      const pad=document.createElement('div'); pad.className='pad'; pad.textContent=name;
      pad.onclick=()=>{ if(audioStarted) playSample(name); pad.classList.add('active'); setTimeout(()=>pad.classList.remove('active'),150); };
      padPanel.appendChild(pad);
    });
  });
}

// Sequencer setup
const sequencer=document.getElementById('sequencer');
let sequencerData={};
function initSequencer(){
  padNames.forEach(track=>{
    sequencerData[track]=new Array(16).fill(false);
    for(let i=0;i<16;i++){
      const step=document.createElement('div'); step.className='step'; step.dataset.track=track; step.dataset.step=i;
      step.onclick=()=>{ sequencerData[track][i]=!sequencerData[track][i]; step.classList.toggle('active',sequencerData[track][i]); };
      sequencer.appendChild(step);
    }
  });
}

// FX Rack per track
const trackFX={};
function initFX(){
  padNames.forEach(track=>{
    const filter=ctx.createBiquadFilter(); filter.type='lowpass'; filter.frequency.value=20000;
    const delay=ctx.createDelay(); delay.delayTime.value=0.25;
    const gain=ctx.createGain(); gain.gain.value=0.8;
    filter.connect(delay); delay.connect(gain); gain.connect(masterGain);
    trackFX[track]={filter,delay,gain};
  });
  // Example Master Controls
  const masterPitchKnob=document.createElement('div'); masterPitchKnob.className='knob';
  const masterPitchLabel=document.createElement('div'); masterPitchLabel.className='label'; masterPitchLabel.textContent='Master Pitch';
  const masterVolKnob=document.createElement('div'); masterVolKnob.className='knob';
  const masterVolLabel=document.createElement('div'); masterVolLabel.className='label'; masterVolLabel.textContent='Master Volume';
  const container=document.getElementById('controlsPanel');
  [masterPitchKnob,masterPitchLabel,masterVolKnob,masterVolLabel].forEach(el=>container.appendChild(el));
  createControl(masterPitchKnob,v=>{ masterPlaybackRate=0.5+v*1.5; });
  createControl(masterVolKnob,v=>{ masterGain.gain.value=v; });
}

// Sequencer playback loop
let stepCounter=0;
const bpm=120;
function highlightStep(stepIndex){
  document.querySelectorAll('.step').forEach(step=>{ step.style.borderColor=''; if(parseInt(step.dataset.step)===stepIndex) step.style.borderColor='#ff5722'; });
}
function sequencerLoop(){
  if(!audioStarted) return setTimeout(sequencerLoop,100);
  padNames.forEach(track=>{ if(sequencerData[track][stepCounter]) playSample(track); });
  highlightStep(stepCounter);
  stepCounter=(stepCounter+1)%16;
  setTimeout(sequencerLoop,(60000/bpm)/4);
}
sequencerLoop();
</script>
<script>
// -----------------------------
// Voice Recorder
// -----------------------------
let recorder, recordedChunks=[], recording=false;
const recBtn=document.createElement('button'); recBtn.textContent='Record Voice';
const downloadBtn=document.createElement('button'); downloadBtn.textContent='Download Voice';
document.getElementById('controlsPanel').appendChild(recBtn);
document.getElementById('controlsPanel').appendChild(downloadBtn);

recBtn.onclick=async ()=>{
  if(!recording){
    const stream=await navigator.mediaDevices.getUserMedia({audio:true});
    recorder=new MediaRecorder(stream);
    recordedChunks=[];
    recorder.ondataavailable=e=>{ if(e.data.size>0) recordedChunks.push(e.data); };
    recorder.start(); recording=true; recBtn.textContent='Stop Recording';
  } else {
    recorder.stop(); recording=false; recBtn.textContent='Record Voice';
  }
};

downloadBtn.onclick=()=>{
  if(recordedChunks.length===0) return;
  const blob=new Blob(recordedChunks,{type:'audio/webm'});
  const url=URL.createObjectURL(blob);
  const a=document.createElement('a'); a.href=url; a.download='voice_recording.webm'; a.click();
  URL.revokeObjectURL(url);
};

// -----------------------------
// Randomization Engine
// -----------------------------
function randomizeSequence(){
  padNames.forEach(track=>{
    sequencerData[track]=sequencerData[track].map(()=>Math.random()<0.3);
  });
  // Update UI
  document.querySelectorAll('.step').forEach(step=>{
    const track=step.dataset.track; const i=parseInt(step.dataset.step);
    step.classList.toggle('active',sequencerData[track][i]);
  });
}

const randBtn=document.createElement('button'); randBtn.textContent='Randomize Sequence';
document.getElementById('controlsPanel').appendChild(randBtn);
randBtn.onclick=randomizeSequence;

// -----------------------------
// Presets
// -----------------------------
const presets={
  'John Summit':[/*16-step boolean arrays per track*/],
  'Fisher':[/*16-step boolean arrays per track*/],
  'Dom Dolla':[/*...*/],
  'Ben Böhmer':[/*...*/],
  'Kygo':[/*...*/],
  'Barry Can’t Swim':[/*...*/]
};

function applyPreset(name){
  const data=presets[name];
  if(!data) return;
  padNames.forEach((track,i)=>{
    sequencerData[track]=data[i] || new Array(16).fill(false);
  });
  document.querySelectorAll('.step').forEach(step=>{
    const track=step.dataset.track; const i=parseInt(step.dataset.step);
    step.classList.toggle('active',sequencerData[track][i]);
  });
}

Object.keys(presets).forEach(name=>{
  const btn=document.createElement('button'); btn.textContent=name;
  btn.onclick=()=>applyPreset(name);
  document.getElementById('controlsPanel').appendChild(btn);
});

// -----------------------------
// Visualizer
// -----------------------------
const canvas=document.getElementById('visualizer');
const ctxVis=canvas.getContext('2d');
canvas.width=canvas.clientWidth; canvas.height=canvas.clientHeight;
const analyser=ctx.createAnalyser();
masterGain.connect(analyser);
analyser.fftSize=256;
const bufferLength=analyser.frequencyBinCount;
const dataArray=new Uint8Array(bufferLength);

function drawVisualizer(){
  requestAnimationFrame(drawVisualizer);
  analyser.getByteFrequencyData(dataArray);
  ctxVis.fillStyle='#111'; ctxVis.fillRect(0,0,canvas.width,canvas.height);
  const barWidth=canvas.width/bufferLength;
  for(let i=0;i<bufferLength;i++){
    const barHeight=dataArray[i]/2;
    ctxVis.fillStyle=`rgb(${barHeight+50},50,${255-barHeight})`;
    ctxVis.fillRect(i*barWidth,canvas.height-barHeight,barWidth,barHeight);
  }
}
drawVisualizer();

// -----------------------------
// Placeholder Base64 Sample Pack
// Replace these with real samples in production
// -----------------------------
const base64Samples={
  'Kick':'UklGRiQAAABXQVZFZm10IBAAAAABAAEAQB8AAIA+AAACABAAZGF0YQAAAAA=',
  'Snare':'UklGRiQAAABXQVZFZm10IBAAAAABAAEAQB8AAIA+AAACABAAZGF0YQAAAAA=',
  'HiHat':'UklGRiQAAABXQVZFZm10IBAAAAABAAEAQB8AAIA+AAACABAAZGF0YQAAAAA=',
  'Clap':'UklGRiQAAABXQVZFZm10IBAAAAABAAEAQB8AAIA+AAACABAAZGF0YQAAAAA=',
  'Piano':'UklGRiQAAABXQVZFZm10IBAAAAABAAEAQB8AAIA+AAACABAAZGF0YQAAAAA=',
  'Trumpet':'UklGRiQAAABXQVZFZm10IBAAAAABAAEAQB8AAIA+AAACABAAZGF0YQAAAAA=',
  'Synth':'UklGRiQAAABXQVZFZm10IBAAAAABAAEAQB8AAIA+AAACABAAZGF0YQAAAAA='
};

// Load real Base64 samples
async function loadFullSamples(){
  for(const name in base64Samples){
    const data=base64Samples[name];
    const res=await fetch('data:audio/wav;base64,'+data);
    const arrayBuffer=await res.arrayBuffer();
    sampleBuffers[name]=await ctx.decodeAudioData(arrayBuffer);
  }
}
loadFullSamples();
</script>
</body>
</html>
