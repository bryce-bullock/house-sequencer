<!DOCTYPE html>
<html>
<head>
  <title>House Beat Maker</title>
  <script src="https://cdn.jsdelivr.net/npm/tone@14.8.39/build/Tone.js"></script>
  <style>
    body {
      font-family: sans-serif;
      background: #0a0a0a;
      color: white;
      text-align: center;
      margin: 0;
      padding: 0;
    }
    h1 { margin: 15px 0; font-size: 6vw; }
    #grid {
      display: grid;
      grid-template-columns: repeat(16, 1fr);
      gap: 0.5vw;
      margin: 10px auto;
      width: 95vw;
      max-width: 900px;
    }
    .row-label {
      grid-column: 1 / span 16;
      margin-top: 1em;
      text-align: left;
      font-size: 3.5vw;
      color: #aaa;
    }
    .cell {
      aspect-ratio: 1 / 1; /* keeps cells square */
      background: #333;
      cursor: pointer;
      border-radius: 6px;
      transition: background 0.2s;
    }
    .cell.active { background: #0f0; }
    button {
      margin: 15px;
      padding: 10px 20px;
      font-size: 4vw;
      max-width: 200px;
      border: none;
      border-radius: 6px;
      background: #222;
      color: white;
      cursor: pointer;
    }
    button:active { background: #444; }
    @media (min-width: 768px) {
      h1 { font-size: 2em; }
      .row-label { font-size: 1em; }
      button { font-size: 1em; }
    }
  </style>
</head>
<body>
  <h1>House Beat Maker</h1>
  <div id="grid"></div>
  <button id="play">Play / Stop</button>

  <script>
    const instruments = ["Kick", "Snare", "HiHat", "Bass"];
    const grid = document.getElementById("grid");
    const cells = [];

    // build sequencer grid
    instruments.forEach((inst, r) => {
      const label = document.createElement("div");
      label.textContent = inst;
      label.classList.add("row-label");
      grid.appendChild(label);

      for (let i = 0; i < 16; i++) {
        const cell = document.createElement("div");
        cell.classList.add("cell");
        cell.dataset.row = r;
        cell.dataset.step = i;
        cell.addEventListener("click", () => cell.classList.toggle("active"));
        cell.addEventListener("touchstart", (e) => {
          e.preventDefault();
          cell.classList.toggle("active");
        });
        grid.appendChild(cell);
        cells.push(cell);
      }
    });

    // drum samples
    const playerKick = new Tone.Player("https://cdn.jsdelivr.net/gh/Tonejs/Tone.js/examples/audio/505/kick.mp3").toDestination();
    const playerSnare = new Tone.Player("https://cdn.jsdelivr.net/gh/Tonejs/Tone.js/examples/audio/505/snare.mp3").toDestination();
    const playerHat = new Tone.Player("https://cdn.jsdelivr.net/gh/Tonejs/Tone.js/examples/audio/505/hh.mp3").toDestination();

    // bass synth with FX
    const reverb = new Tone.Reverb({ decay: 3, wet: 0.3 }).toDestination();
    const delay = new Tone.FeedbackDelay("8n", 0.3).connect(reverb);

    const bass = new Tone.MonoSynth({
      oscillator: { type: "sawtooth" },
      envelope: { attack: 0.01, decay: 0.2, sustain: 0.2, release: 0.6 },
      filterEnvelope: { attack: 0.01, decay: 0.1, sustain: 0.2, release: 0.6, baseFrequency: 100, octaves: 2.6 }
    }).connect(delay);

    let stepIndex = 0;
    const loop = new Tone.Loop((time) => {
      for (let r = 0; r < instruments.length; r++) {
        const cell = cells[r * 16 + stepIndex];
        if (cell.classList.contains("active")) {
          if (r === 0) playerKick.start(time);
          if (r === 1) playerSnare.start(time);
          if (r === 2) playerHat.start(time);
          if (r === 3) bass.triggerAttackRelease("C2", "8n", time);
        }
      }
      stepIndex = (stepIndex + 1) % 16;
    }, "16n");

    let playing = false;
    document.getElementById("play").onclick = async () => {
      if (!playing) {
        await Tone.start();
        Tone.Transport.start();
        loop.start(0);
        playing = true;
      } else {
        Tone.Transport.stop();
        loop.stop();
        stepIndex = 0;
        playing = false;
      }
    };
  </script>
</body>
</html>
