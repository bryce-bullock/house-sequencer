<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DJ Groove Station</title>
    <style>
        body {
            background-color: #000;
            color: #fff;
            font-family: 'Arial', sans-serif;
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            overflow: hidden;
        }
        #app {
            width: 800px;
            height: 600px;
            background: linear-gradient(to bottom, #111, #222);
            border: 2px solid #333;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 0 20px rgba(0, 255, 0, 0.2);
            display: grid;
            grid-template-rows: auto 1fr auto;
            gap: 20px;
        }
        h1 {
            text-align: center;
            font-size: 24px;
            margin: 0;
            color: #0f0;
            text-shadow: 0 0 5px #0f0;
        }
        .controls {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
        }
        button {
            background-color: #333;
            border: 1px solid #555;
            color: #fff;
            font-size: 16px;
            padding: 15px;
            cursor: pointer;
            border-radius: 5px;
            transition: all 0.2s;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
        }
        button:hover {
            background-color: #444;
            box-shadow: 0 0 15px rgba(0, 255, 0, 0.3);
        }
        button.active {
            background-color: #0f0;
            color: #000;
            box-shadow: 0 0 20px #0f0;
        }
        .preset-btn {
            background-color: #222;
            border-color: #0f0;
        }
        .add-sound-btn {
            background-color: #222;
            border-color: #00f;
        }
        .footer {
            text-align: center;
            font-size: 12px;
            color: #888;
        }
    </style>
</head>
<body>
    <div id="app">
        <h1>DJ Groove Station</h1>
        <div class="controls">
            <button class="preset-btn" onclick="startPreset('deep')">Deep House Preset</button>
            <button class="preset-btn" onclick="startPreset('tech')">Tech House Preset</button>
            <button onclick="stopAll()">Stop</button>
            <button class="add-sound-btn" onclick="addSynth('lead')">Add Synth Lead</button>
            <button class="add-sound-btn" onclick="addSynth('pad')">Add Atmospheric Pad</button>
            <button class="add-sound-btn" onclick="addRandomTameSound()">Add Random Tame Sound</button>
        </div>
        <div class="footer">Inspired by Rufus Du Sol, John Summit, Chris Lake, Dom Dolla & Tame Impala vibes</div>
    </div>
    <script>
        let audioCtx = null;
        let isPlaying = false;
        let nextNoteTime = 0;
        let scheduleAheadTime = 0.1;
        let currentNote = 0;
        let tempo = 128; // BPM
        let secondsPerBeat = 60 / tempo;
        let drumPatterns = {};
        let bassPatterns = {};
        let activeSynths = [];
        let presetType = '';

        function initAudio() {
            if (!audioCtx) {
                audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            }
            if (audioCtx.state === 'suspended') {
                audioCtx.resume();
            }
        }

        function playSound(freq, type, duration, time, volume = 1, envelope = true) {
            const osc = audioCtx.createOscillator();
            osc.type = type;
            osc.frequency.value = freq;

            const gain = audioCtx.createGain();
            gain.gain.value = 0;

            if (envelope) {
                gain.gain.setValueAtTime(volume, time);
                gain.gain.exponentialRampToValueAtTime(0.01, time + duration);
            } else {
                gain.gain.value = volume;
            }

            osc.connect(gain).connect(audioCtx.destination);
            osc.start(time);
            osc.stop(time + duration);
        }

        function playKick(time) {
            const osc = audioCtx.createOscillator();
            osc.type = 'sine';
            osc.frequency.setValueAtTime(150, time);
            osc.frequency.exponentialRampToValueAtTime(0.01, time + 0.2);

            const gain = audioCtx.createGain();
            gain.gain.setValueAtTime(1, time);
            gain.gain.exponentialRampToValueAtTime(0.01, time + 0.2);

            osc.connect(gain).connect(audioCtx.destination);
            osc.start(time);
            osc.stop(time + 0.2);
        }

        function playSnare(time) {
            const noise = audioCtx.createBufferSource();
            const buffer = audioCtx.createBuffer(1, audioCtx.sampleRate * 0.05, audioCtx.sampleRate);
            const data = buffer.getChannelData(0);
            for (let i = 0; i < data.length; i++) {
                data[i] = Math.random() * 2 - 1;
            }
            noise.buffer = buffer;

            const filter = audioCtx.createBiquadFilter();
            filter.type = 'highpass';
            filter.frequency.value = 1000;

            const gain = audioCtx.createGain();
            gain.gain.setValueAtTime(0.7, time);
            gain.gain.exponentialRampToValueAtTime(0.01, time + 0.2);

            noise.connect(filter).connect(gain).connect(audioCtx.destination);
            noise.start(time);
        }

        function playHiHat(time, open = false) {
            const noise = audioCtx.createBufferSource();
            const buffer = audioCtx.createBuffer(1, audioCtx.sampleRate * (open ? 0.3 : 0.02), audioCtx.sampleRate);
            const data = buffer.getChannelData(0);
            for (let i = 0; i < data.length; i++) {
                data[i] = Math.random() * 2 - 1;
            }
            noise.buffer = buffer;

            const filter = audioCtx.createBiquadFilter();
            filter.type = 'highpass';
            filter.frequency.value = 5000;

            const gain = audioCtx.createGain();
            gain.gain.setValueAtTime(0.3, time);
            gain.gain.exponentialRampToValueAtTime(0.01, time + (open ? 0.3 : 0.05));

            noise.connect(filter).connect(gain).connect(audioCtx.destination);
            noise.start(time);
        }

        function playBass(note, time) {
            playSound(note, 'sawtooth', secondsPerBeat / 2, time, 0.6);
        }

        function createSynth(type) {
            const osc = audioCtx.createOscillator();
            osc.type = type === 'lead' ? 'sawtooth' : 'sine';
            osc.frequency.value = type === 'lead' ? 440 : 220; // A4 or A3

            const gain = audioCtx.createGain();
            gain.gain.value = 0.3;

            const filter = audioCtx.createBiquadFilter();
            filter.type = 'lowpass';
            filter.frequency.value = type === 'lead' ? 800 : 400;

            osc.connect(filter).connect(gain).connect(audioCtx.destination);
            osc.start();
            return { osc, gain, filter };
        }

        function addSynth(type) {
            const synth = createSynth(type);
            activeSynths.push(synth);
            // Modulate frequency randomly for interest
            setInterval(() => {
                synth.osc.frequency.value = type === 'lead' ? 440 + Math.random() * 100 - 50 : 220 + Math.random() * 50 - 25;
            }, 1000);
        }

        function addRandomTameSound() {
            // Tame Impala-like: dreamy, detuned synth with chorus effect
            const time = audioCtx.currentTime;
            const detune = Math.random() * 20 - 10;
            const freq = 300 + Math.random() * 200;
            const osc1 = audioCtx.createOscillator();
            osc1.type = 'sawtooth';
            osc1.frequency.value = freq;
            osc1.detune.value = detune;

            const osc2 = audioCtx.createOscillator();
            osc2.type = 'sawtooth';
            osc2.frequency.value = freq;
            osc2.detune.value = -detune;

            const gain = audioCtx.createGain();
            gain.gain.setValueAtTime(0.4, time);
            gain.gain.exponentialRampToValueAtTime(0.01, time + 2 + Math.random() * 3);

            const delay = audioCtx.createDelay(0.03);
            const feedback = audioCtx.createGain();
            feedback.gain.value = 0.3;

            osc1.connect(gain);
            osc2.connect(delay).connect(feedback).connect(gain);
            feedback.connect(delay);
            gain.connect(audioCtx.destination);

            osc1.start(time);
            osc2.start(time);
            osc1.stop(time + 5);
            osc2.stop(time + 5);
        }

        function nextNote() {
            currentNote = (currentNote + 1) % 16;
        }

        function scheduleNote(note, time) {
            const pattern = drumPatterns[presetType];
            if (!pattern) return;

            if (note % 4 === 0) playKick(time); // Kick on every beat

            if (pattern.snare.includes(note)) playSnare(time);
            if (pattern.hihat.includes(note)) playHiHat(time);
            if (pattern.openhihat.includes(note)) playHiHat(time, true);

            const bassPattern = bassPatterns[presetType];
            if (bassPattern[note]) {
                playBass(bassPattern[note], time);
            }
        }

        function scheduler() {
            while (nextNoteTime < audioCtx.currentTime + scheduleAheadTime) {
                scheduleNote(currentNote, nextNoteTime);
                nextNote();
                nextNoteTime += secondsPerBeat / 4; // 16th notes
            }
            if (isPlaying) {
                requestAnimationFrame(scheduler);
            }
        }

        function startPreset(type) {
            initAudio();
            if (isPlaying) stopAll();
            presetType = type;
            drumPatterns.deep = {
                snare: [4, 12],
                hihat: [2, 6, 10, 14],
                openhihat: [0, 8]
            };
            drumPatterns.tech = {
                snare: [4, 12],
                hihat: [1, 3, 5, 7, 9, 11, 13, 15],
                openhihat: [0, 8]
            };
            bassPatterns.deep = [0, null, null, null, 98, null, null, null, 0, null, null, null, 98, null, null, null].map(n => n ? 98 : null); // Low E
            bassPatterns.tech = [82, null, 82, null, 98, null, 98, null, 82, null, 82, null, 98, null, 98, null]; // More rhythmic

            isPlaying = true;
            currentNote = 0;
            nextNoteTime = audioCtx.currentTime + 0.05;
            scheduler();
            document.querySelector(`button[onclick="startPreset('${type}')"]`).classList.add('active');
        }

        function stopAll() {
            isPlaying = false;
            activeSynths.forEach(synth => {
                synth.osc.stop();
            });
            activeSynths = [];
            document.querySelectorAll('button.active').forEach(btn => btn.classList.remove('active'));
        }
    </script>
</body>
</html>
