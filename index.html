<!DOCTYPE html>
<html>
<head>
  <title>House Beat Maker</title>
  <script src="https://cdn.jsdelivr.net/npm/tone@14.8.39/build/Tone.js"></script>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: radial-gradient(circle at top, #111 0%, #000 100%);
      color: white;
      text-align: center;
      margin: 0;
      padding: 20px;
    }
    h1 {
      font-size: 2.5em;
      margin-bottom: 10px;
      color: #0ff;
      text-shadow: 0 0 10px #0ff;
    }
    #pageLabel {
      font-size: 1.2em;
      margin-bottom: 15px;
      color: #0ff;
      text-shadow: 0 0 8px #0ff;
    }
    #grid {
      display: grid;
      grid-template-columns: repeat(16, 40px);
      gap: 6px;
      margin: 20px auto;
      width: max-content;
      background: #111;
      padding: 15px;
      border-radius: 12px;
      box-shadow: 0 0 20px rgba(0, 255, 255, 0.2);
    }
    .cell {
      width: 40px;
      height: 40px;
      background: #222;
      border-radius: 8px;
      cursor: pointer;
      transition: background 0.2s, transform 0.1s;
    }
    .cell:hover { transform: scale(1.05); }
    .cell.active {
      background: #0ff;
      box-shadow: 0 0 10px #0ff, 0 0 20px #0ff;
    }
    .cell.current {
      border: 2px solid #f0f;
      box-shadow: 0 0 15px #f0f;
    }
    button {
      margin: 10px;
      padding: 12px 24px;
      font-size: 1.1em;
      border: none;
      border-radius: 8px;
      background: #0ff;
      color: black;
      cursor: pointer;
      font-weight: bold;
      transition: background 0.2s;
    }
    button:hover { background: #0cc; }
    .controls {
      margin-top: 25px;
      display: flex;
      justify-content: center;
      gap: 40px;
      flex-wrap: wrap;
    }
    .control {
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    input[type=range] { width: 150px; }
    label { margin-bottom: 6px; font-size: 0.9em; color: #aaa; }
    @media (max-width: 768px) {
      #grid { grid-template-columns: repeat(16, 20px); }
      .cell { width: 20px; height: 20px; }
    }
  </style>
</head>
<body>
  <h1>House Beat Maker</h1>
  <div id="pageLabel">Page: Drums</div>
  <div id="grid"></div>
  <div>
    <button id="play">â–¶ Play / Stop</button>
    <button id="pageToggle">Switch Page</button>
  </div>

  <div class="controls">
    <div class="control">
      <label for="tempo">Tempo (BPM)</label>
      <input type="range" id="tempo" min="60" max="180" value="120">
    </div>
    <div class="control">
      <label for="filter">Filter Cutoff</label>
      <input type="range" id="filter" min="200" max="8000" value="5000">
    </div>
  </div>

  <script>
    const pages = [
      { name: "Drums", instruments: ["Kick", "Snare", "HiHat"] },
      { name: "Percussion", instruments: ["Bass", "Clap", "Shaker"] }
    ];
    let currentPage = 0;

    const grid = document.getElementById("grid");
    const pageLabel = document.getElementById("pageLabel");
    let cells = [];

    function buildGrid() {
      grid.innerHTML = "";
      cells = [];
      pages[currentPage].instruments.forEach((row, r) => {
        for (let i = 0; i < 16; i++) {
          const cell = document.createElement("div");
          cell.classList.add("cell");
          cell.dataset.row = r;
          cell.dataset.step = i;
          cell.onclick = () => { cell.classList.toggle("active"); };
          grid.appendChild(cell);
          cells.push(cell);
        }
      });
      pageLabel.textContent = `Page: ${pages[currentPage].name}`;
    }

    buildGrid();

    // instruments
    const instruments = {
      "Kick": new Tone.MembraneSynth(),
      "Snare": new Tone.NoiseSynth({ envelope: { attack: 0.001, decay: 0.2, sustain: 0 } }),
      "HiHat": new Tone.MetalSynth({ envelope: { attack: 0.001, decay: 0.1, release: 0.1 } }),
      "Bass": new Tone.MonoSynth({ oscillator: { type: "sawtooth" }, envelope: { attack: 0.01, decay: 0.2, sustain: 0.2, release: 0.6 } }),
      "Clap": new Tone.NoiseSynth({ envelope: { attack: 0.001, decay: 0.2 }, volume: -5 }),
      "Shaker": new Tone.MetalSynth({ envelope: { attack: 0.001, decay: 0.05, release: 0.05 }, volume: -8 })
    };

    const filter = new Tone.Filter(5000, "lowpass").toDestination();
    Object.values(instruments).forEach(inst => inst.connect(filter));

    let stepIndex = 0;
    const loop = new Tone.Loop((time) => {
      // clear previous step indicator
      cells.forEach(c => c.classList.remove("current"));

      pages[currentPage].instruments.forEach((instName, r) => {
        const cell = cells[r * 16 + stepIndex];
        if (cell.classList.contains("active")) {
          instruments[instName].triggerAttackRelease("C2", "8n", time);
        }
        cell.classList.add("current"); // highlight current step
      });

      stepIndex = (stepIndex + 1) % 16;
    }, "16n");

    let playing = false;
    document.getElementById("play").onclick = async () => {
      if (!playing) {
        await Tone.start();
        Tone.Transport.start();
        loop.start(0);
        playing = true;
      } else {
        Tone.Transport.stop();
        loop.stop();
        stepIndex = 0;
        cells.forEach(c => c.classList.remove("current"));
        playing = false;
      }
    };

    document.getElementById("pageToggle").onclick = () => {
      currentPage = (currentPage + 1) % pages.length;
      buildGrid();
    };

    document.getElementById("tempo").addEventListener("input", (e) => {
      Tone.Transport.bpm.value = +e.target.value;
    });

    document.getElementById("filter").addEventListener("input", (e) => {
      filter.frequency.value = +e.target.value;
    });
  </script>
</body>
</html>
