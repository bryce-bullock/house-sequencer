<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Pro House 16-Step Sequencer</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="https://cdn.jsdelivr.net/npm/tone@14.8.39/build/Tone.js"></script>
<style>
:root {
  --bg:#121212; --panel:#181818; --border:#2a2a2a;
  --text:#e0e0e0; --accent:#00b894; --current:#ffffff;
}
body { background:var(--bg); color:var(--text); font-family:system-ui, sans-serif; margin:0; padding:24px; text-align:center; }
h1 { font-size:1.35rem; font-weight:600; margin:0 0 10px; }
#gridWrap { display:grid; justify-content:center; gap:6px; margin:12px 0; }
.lane { display:flex; gap:6px; }
.block { width:40px; height:40px; border-radius:6px; background:#1e1e1e; border:1px solid #2f2f2f; cursor:pointer; display:flex; align-items:center; justify-content:center; transition:.1s; }
.block.active { background:var(--accent); box-shadow:0 0 8px var(--accent); }
.block.current { outline:2px solid var(--current); }
.controls, .toolbar { display:flex; flex-wrap:wrap; justify-content:center; gap:10px; margin:8px 0; }
button, select, input[type=range] { background:var(--panel); color:var(--text); border:1px solid var(--border); border-radius:8px; padding:8px 12px; font-size:.95rem; cursor:pointer; }
input[type=range]{width:160px; height:36px; margin-top:4px;}
input[type=range]::-webkit-slider-thumb, input[type=range]::-moz-range-thumb { width:20px; height:20px; border-radius:50%; background:var(--accent); border:2px solid #0f0f0f; }
@media(max-width:800px){ .block{width:30px;height:30px;} input[type=range]{width:140px;} }
</style>
</head>
<body>
<h1>Pro House 16-Step Sequencer</h1>
<div class="toolbar">
  <button id="play">â–¶ Play / Stop</button>
  <select id="vibeSelect">
    <option value="fisher">Fisher</option>
    <option value="john">John Summit</option>
    <option value="dom">Dom Dolla</option>
    <option value="kygo">Kygo</option>
    <option value="alesso">Alesso</option>
    <option value="random">Random</option>
  </select>
  <button id="applyVibe">Apply</button>
</div>
<div class="controls">
  <div><label>Tempo (BPM)</label><input type="range" id="tempo" min="80" max="160" value="124"></div>
  <div><label>Swing (%)</label><input type="range" id="swing" min="0" max="100" value="12"></div>
  <div><label>Filter (Hz)</label><input type="range" id="filter" min="200" max="12000" value="5500"></div>
</div>
<div id="gridWrap"></div>

<script>
const lanes = ["Kick","Snare","HiHat","Clap","Shaker","Bass"];
const steps = 16;
const active = lanes.map(()=>Array(steps).fill(false));
const gridWrap = document.getElementById("gridWrap");
let currentStep=0, playing=false;

// ---------- AUDIO SETUP ----------
const instruments = {
  "Kick": new Tone.MembraneSynth(),
  "Snare": new Tone.NoiseSynth({ envelope:{ attack:0.001, decay:0.2, sustain:0 } }),
  "HiHat": new Tone.MetalSynth({ envelope:{attack:0.001,decay:0.08,release:0.08}, resonance:4000 }),
  "Clap": new Tone.NoiseSynth({ envelope:{attack:0.001, decay:0.15}, volume:-4 }),
  "Shaker": new Tone.MetalSynth({ envelope:{attack:0.001,decay:0.05,release:0.03}, volume:-8 }),
  "Bass": new Tone.MonoSynth({ oscillator:{type:"sawtooth"}, filter:{Q:2}, envelope:{attack:0.01, decay:0.2, sustain:0.25, release:0.5} })
};
const filter = new Tone.Filter(5500,"lowpass").toDestination();
Object.values(instruments).forEach(inst=>inst.connect(filter));
Tone.Transport.bpm.value=124; Tone.Transport.swing=0.12; Tone.Transport.swingSubdivision="16n";

// ---------- GRID ----------
function buildGrid(){
  gridWrap.innerHTML="";
  lanes.forEach((lane,r)=>{
    const row = document.createElement("div"); row.className="lane";
    for(let s=0;s<steps;s++){
      const blk = document.createElement("div"); blk.className="block";
      if(active[r][s]) blk.classList.add("active");
      if(s===currentStep) blk.classList.add("current");
      blk.addEventListener("pointerdown", ()=>{ 
        active[r][s] = !active[r][s]; blk.classList.toggle("active", active[r][s]);
      });
      row.appendChild(blk);
    }
    gridWrap.appendChild(row);
  });
}
function updateHighlight(){
  const rows = document.querySelectorAll(".lane");
  rows.forEach((row,r)=>{
    const blks=row.children;
    for(let s=0;s<blks.length;s++){
      blks[s].classList.toggle("current", s===currentStep);
    }
  });
}

// ---------- LOOP ----------
const loop = new Tone.Loop(time=>{
  lanes.forEach((lane,r)=>{
    if(active[r][currentStep]){
      instruments[lane].triggerAttackRelease("C2","8n", time + r*0.002); // slight stagger
    }
  });
  currentStep = (currentStep+1)%steps;
  updateHighlight();
},"16n");

// ---------- CONTROLS ----------
document.getElementById("play").addEventListener("click", async()=>{
  if(!playing){
    await Tone.start();
    loop.start(0);
    Tone.Transport.start();
    playing=true;
  } else {
    Tone.Transport.stop();
    loop.stop();
    currentStep=0; updateHighlight();
    playing=false;
  }
});
document.getElementById("tempo").addEventListener("input", e=>Tone.Transport.bpm.value=+e.target.value);
document.getElementById("swing").addEventListener("input", e=>Tone.Transport.swing=(+e.target.value)/100);
document.getElementById("filter").addEventListener("input", e=>filter.frequency.value=+e.target.value);

// ---------- RANDOMIZE / VIBES ----------
function clearAll(){ active.forEach(l=>l.fill(false)); }
function randomizeVibe(name){
  clearAll();
  switch(name){
    case "fisher": [0,2,4,6].forEach(i=>active[0][i]=true); [1,5].forEach(i=>active[1][i]=true); [1,3,5,7].forEach(i=>active[2][i]=true); break;
    case "john": [0,2,4,6].forEach(i=>active[0][i]=true); [4,6].forEach(i=>active[1][i]=true); [1,3,5,7].forEach(i=>active[2][i]=true); break;
    case "dom": [0,2,4,6].forEach(i=>active[0][i]=true); [1,3,5,7].forEach(i=>active[1][i]=true); [0,2,4,6].forEach(i=>active[2][i]=true); break;
    case "kygo": [0,4,8,12].forEach(i=>active[0][i]=true); [2,6,10,14].forEach(i=>active[1][i]=true); break;
    case "alesso": [0,2,4,6,8,10,12,14].forEach(i=>active[0][i]=true); [1,5,9,13].forEach(i=>active[1][i]=true); break;
    case "random": active.forEach(l=>l.forEach((_,i)=>l[i]=Math.random()>0.5)); break;
  }
  buildGrid(); updateHighlight();
}
document.getElementById("applyVibe").addEventListener("click", ()=>randomizeVibe(document.getElementById("vibeSelect").value));

// ---------- INIT ----------
randomizeVibe("random");
</script>
</body>
</html>
