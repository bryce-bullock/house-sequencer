<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simple House Music Sequencer</title>
    <script src="https://unpkg.com/tone"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f0f0f0;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
        }
        #sequencer {
            display: grid;
            grid-template-columns: 100px repeat(16, 40px);
            gap: 2px;
            margin-bottom: 20px;
        }
        .label {
            text-align: right;
            padding-right: 10px;
            font-weight: bold;
        }
        button.step {
            width: 40px;
            height: 40px;
            background-color: #ddd;
            border: 1px solid #aaa;
            cursor: pointer;
        }
        button.step.active {
            background-color: #4caf50;
        }
        #controls {
            display: flex;
            gap: 10px;
        }
        #playButton {
            padding: 10px 20px;
            background-color: #2196f3;
            color: white;
            border: none;
            cursor: pointer;
        }
        #tempo {
            width: 200px;
        }
    </style>
</head>
<body>
    <h1>House Music Sequencer</h1>
    <p>Inspired by Rufus Du Sol and Dom Dolla. Click the grid to toggle steps, then play!</p>
    <div id="sequencer"></div>
    <div id="controls">
        <button id="playButton">Play</button>
        <label for="tempo">Tempo: <span id="tempoValue">120</span> BPM</label>
        <input type="range" id="tempo" min="60" max="180" value="120">
    </div>

    <script>
        // Define instruments
        const instruments = [
            { name: 'Kick', sampler: new Tone.Sampler({ 'C3': 'https://tonejs.github.io/audio/drum-samples/techno-kit/kick.wav' }).toDestination(), note: 'C3' },
            { name: 'Clap', sampler: new Tone.Sampler({ 'C3': 'https://tonejs.github.io/audio/drum-samples/techno-kit/clap.wav' }).toDestination(), note: 'C3' },
            { name: 'Hat', sampler: new Tone.Sampler({ 'C3': 'https://tonejs.github.io/audio/drum-samples/techno-kit/hihat-closed.wav' }).toDestination(), note: 'C3' },
            { name: 'Perc', sampler: new Tone.Sampler({ 'C3': 'https://tonejs.github.io/audio/drum-samples/techno-kit/rim.wav' }).toDestination(), note: 'C3' },
            { name: 'Bass', sampler: new Tone.Synth({ oscillator: { type: 'sawtooth' }, envelope: { attack: 0.01, decay: 0.1, sustain: 0.2, release: 0.3 } }).toDestination(), note: 'F2' },
            { name: 'Synth1', sampler: new Tone.Synth().toDestination(), note: 'F3' },
            { name: 'Synth2', sampler: new Tone.Synth().toDestination(), note: 'Ab3' },
            { name: 'Synth3', sampler: new Tone.Synth().toDestination(), note: 'Bb3' },
            { name: 'Synth4', sampler: new Tone.Synth().toDestination(), note: 'C4' },
            { name: 'Synth5', sampler: new Tone.Synth().toDestination(), note: 'Eb4' }
        ];

        // Create grid
        const steps = 16;
        const grid = instruments.map(inst => 
            Array(steps).fill().map(() => ({ isActive: false }))
        );

        // Build UI
        const sequencerDiv = document.getElementById('sequencer');
        instruments.forEach((inst, rowIndex) => {
            // Label
            const label = document.createElement('div');
            label.className = 'label';
            label.textContent = inst.name;
            sequencerDiv.appendChild(label);

            // Steps
            for (let col = 0; col < steps; col++) {
                const button = document.createElement('button');
                button.className = 'step';
                button.addEventListener('click', () => {
                    grid[rowIndex][col].isActive = !grid[rowIndex][col].isActive;
                    button.classList.toggle('active');
                });
                sequencerDiv.appendChild(button);
            }
        });

        // Sequencing logic
        let step = 0;
        const repeat = (time) => {
            instruments.forEach((inst, rowIndex) => {
                if (grid[rowIndex][step].isActive) {
                    inst.sampler.triggerAttackRelease(inst.note, '16n', time);
                }
            });
            step = (step + 1) % steps;
        };

        Tone.Transport.scheduleRepeat(repeat, '16n');

        // Play/Pause
        let isPlaying = false;
        const playButton = document.getElementById('playButton');
        playButton.addEventListener('click', async () => {
            if (!isPlaying) {
                await Tone.start();
                Tone.Transport.start();
                playButton.textContent = 'Pause';
                isPlaying = true;
            } else {
                Tone.Transport.pause();
                playButton.textContent = 'Play';
                isPlaying = false;
            }
        });

        // Tempo control
        const tempoInput = document.getElementById('tempo');
        const tempoValue = document.getElementById('tempoValue');
        tempoInput.addEventListener('input', (e) => {
            Tone.Transport.bpm.value = e.target.value;
            tempoValue.textContent = e.target.value;
        });
    </script>
</body>
</html>
